#!/bin/bash

# http://redsymbol.net/articles/unofficial-bash-strict-mode/
# http://www.gnu.org/software/bash/manual/bash.html#The-Set-Builtin
set -o nounset  # Treat unset variables as an error when substituting
set -o errexit  # Exit immediately if a command exits with a non-zero status
set -o pipefail # Status code of a pipeline will be the status code of first failed command in it or 0

script=`realpath $0`
scriptdir=`dirname $script`
scriptname=`basename $script`

d=`realpath $scriptdir/..`

$d/bin/configure-npm

if ! test -e $d/node_modules/.bin/phantomjs > /dev/null; then
    echo error: phantomjs is required
    exit 1
fi

if dpkg --compare-versions `$d/node_modules/.bin/phantomjs --version` lt 2.0; then
    echo error: phantomjs at least 2.0 is required
    exit 1
fi
